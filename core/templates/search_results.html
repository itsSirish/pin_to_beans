{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}  {# contains get_item filter #}

{% block title %}Search Results{% endblock %}

{% block styles %}
<style>
.search-results-grid {
    padding: 20px 60px;
}

.pin-grid,
.board-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 12px;
}

/* PIN CARDS (Dashboard Style) */
.pin-card {
    position: relative;
    height: 240px;
    border-radius: 0;
    box-shadow: none;
    background: transparent;
    overflow: hidden;
}

.pin-image-wrapper {
    height: 100%;
    overflow: hidden;
}

.pin-image-wrapper img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    border-radius: 0;
}

.pin-meta {
    position: absolute;
    bottom: 0;
    left: 0;
    background: rgba(255,255,255,0.95);
    padding: 6px 10px;
    font-size: 0.8rem;
    width: 100%;
    box-sizing: border-box;
    font-weight: 500;
    color: #444;
}

/* BOARD CARDS */
.board-card {
    background: #fff;
    border-radius: 6px;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
}

.board-title {
    font-weight: bold;
    padding: 10px;
    font-size: 0.95rem;
    background: #f5f5f5;
    border-bottom: 1px solid #eee;
}

.board-title a {
    color: var(--accent);
    text-decoration: none;
}

.thumb-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 3px;
}

.thumb-wrapper img {
    width: 100%;
    height: 100px;
    object-fit: cover;
    display: block;
}

.stream-button-wrapper {
    margin-top: 10px;
    text-align: center;
  }

  .stream-button-wrapper button {
    background-color: var(--accent);
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 0.85rem;
    cursor: pointer;
    width: 100%;
  }

</style>
{% endblock %}

{% block content %}
<div class="search-results-grid">
  {% if pins %}
    <h3>ðŸ“Œ Matching Pins</h3>
    <div class="pin-grid">
      {% for pin in pins %}
        <div class="pin-card">
          <div class="pin-image-wrapper">
            <a href="{% url 'pin_detail' pin.pin_id %}" data-ajax>
              <img src="{% url 'image_blob' pin.image.image_id %}" alt="Pin Image">
            </a>
          </div>
          <div class="pin-meta">
            ðŸ“Œ {{ pin.user.name }}<br>
            ðŸ•“ {{ pin.timestamp|date:"M d, Y H:i" }}
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  {% if pinboards %}
    <h3 style="margin-top: 30px;">ðŸ“‹ Matching Pinboards</h3>
    <div class="board-grid">
      {% for board in pinboards %}
        <div class="board-card">
          <div class="board-title">
            <a href="{% url 'board_detail' board.board_id %}" data-ajax>
              {{ board.name }} ({{ board.category }})
            </a>
          </div>
          <div class="thumb-grid">
            {% for image_id in preview_images|get_item:board.board_id %}
              <div class="thumb-wrapper">
                <img src="{% url 'image_blob' image_id %}" alt="Preview">
              </div>
            {% empty %}
              <div style="font-size:0.9rem; color:#777; padding:0.5rem;">
                No pins yet
              </div>
            {% endfor %}
          </div>
          <div class="stream-button-wrapper" style="padding: 8px; text-align: right;">
            <form method="get" action="{% url 'add_to_stream' board.board_id %}">
              <button type="submit">âž• Add to Stream</button>
            </form>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
  {% if not pins and not pinboards %}
    <p style="margin-top: 20px; font-style: italic; color: #777;">
      No results found for "{{ query }}".
    </p>
  {% endif %}
  </div>

{% endblock %}
